<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>My Wasm Project</title>
  </head>

  <body>
    <script type="module">
      // Importing WASM as a JS module requires us to call an init function provided by the default export.
      // This is planned to be changed in the future.
      import { default as wasm, mimc_array, mimc_json, mimc_serde } from "./pkg/mimc_wasm.js";

      wasm().then((module) => {
          console.log("trying")

          let task = {
            chunkFootprint: {
              bottomLeft:{
                x:0,
                y:0,
              },
              sideLength:256
            },
            planetHashKey:8,
            planetRarity:16384
          };
          
          var blah = mimc_array(task);
          console.log(blah);


          var times = [];
          for (let i=0; i<10000;i++){
            var t0 = performance.now()
            var blah = mimc_array(task);
            // todo gives back ptr for chunkFootprint
            var t1 = performance.now()
            let time = (t1 - t0);
            times.push(time);
          }
          var avg = times.reduce( (accumulator, currentValue) => accumulator + currentValue) / times.length;
          console.log("Call to mimc_array average " + avg + " milliseconds.")
          console.log('\n\n')

          var times = [];
          for (let i=0; i<10000;i++){
            var t0 = performance.now()
            var blah = mimc_json(task);
            var t1 = performance.now()
            let time = (t1 - t0);
            times.push(time);
          }
          var avg = times.reduce( (accumulator, currentValue) => accumulator + currentValue) / times.length;
          console.log("Call to mimc_json average " + avg + " milliseconds.")
          console.log('\n\n')

          var times = [];
          for (let i=0; i<10000;i++){
            var t0 = performance.now()
            var blah = mimc_serde(task);
            var t1 = performance.now()
            let time = (t1 - t0);
            times.push(time);
          }
          var avg = times.reduce( (accumulator, currentValue) => accumulator + currentValue) / times.length;
          console.log("Call to mimc_serde average " + avg + " milliseconds.")


      });
    </script>
  </body>
</html>
